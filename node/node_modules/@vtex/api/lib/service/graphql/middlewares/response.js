"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ramda_1 = require("ramda");
const cacheControl_1 = require("../utils/cacheControl");
const SEGMENT_HEADER = 'x-vtex-segment';
exports.response = async (ctx, next) => {
    const { responseInit, graphqlResponse } = ctx.graphql;
    const { maxAge = '', scope = '', segment = null, } = graphqlResponse ? cacheControl_1.cacheControl(graphqlResponse, ctx) : {};
    ctx.set(Object.assign({}, responseInit && responseInit.headers, { 'Cache-Control': `${maxAge}, ${scope}` }));
    if (segment) {
        ctx.vary(SEGMENT_HEADER);
    }
    ctx.body = ramda_1.pick(['data', 'errors'], graphqlResponse);
    await next();
};
